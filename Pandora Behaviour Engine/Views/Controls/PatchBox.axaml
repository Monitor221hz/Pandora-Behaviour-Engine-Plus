<!--
  ~ SPDX-License-Identifier: GPL-3.0-or-later
  ~ Copyright (C) 2023-2026 Pandora Behaviour Engine Contributors
-->

<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
			       xmlns:vm="using:Pandora.ViewModels"
						 xmlns:ui="using:FluentAvalonia.UI.Controls"
             mc:Ignorable="d" d:DesignWidth="500" d:DesignHeight="450"
             x:Class="Pandora.Views.PatchBox"
			       x:DataType="vm:PatchBoxViewModel">
	<UserControl.KeyBindings>
		<KeyBinding Gesture="Escape" Command="{Binding HideSearchCommand}" />
	</UserControl.KeyBindings>
	<UserControl.Styles>
		<Style Selector="AutoCompleteBox.SearchBox">
			<Setter Property="Opacity" Value="0" />
			<Setter Property="IsHitTestVisible" Value="False" />
			<Setter Property="RenderTransform" Value="translateY(40px)" />
			<Setter Property="Transitions">
				<Transitions>
					<DoubleTransition Property="Opacity" Duration="0:0:0.25" />
					<TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.25" Easing="CubicEaseOut" />
				</Transitions>
			</Setter>
		</Style>

		<Style Selector="AutoCompleteBox.SearchBox.Open">
			<Setter Property="Opacity" Value="1" />
			<Setter Property="IsHitTestVisible" Value="True" />
			<Setter Property="RenderTransform" Value="translateY(0px)" />
		</Style>

		<Style Selector="ToggleButton.SearchToggle:checked">
			<Style Selector="^ /template/ ContentPresenter#PART_ContentPresenter">
				<Setter Property="Background" Value="{DynamicResource ToggleButtonBackgroundChecked}" />
				<Setter Property="BorderBrush" Value="{DynamicResource ToggleButtonBorderBrushChecked}" />
				<Setter Property="Foreground" Value="{DynamicResource ToggleButtonForegroundChecked}" />
			</Style>
		</Style>

		<Style Selector="ToggleButton.SearchToggle ui|FontIcon">
			<Setter Property="Transitions">
				<Transitions>
					<TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.25" Easing="CubicEaseOut" />
				</Transitions>
			</Setter>
			<Setter Property="RenderTransform" Value="rotate(0deg)" />
		</Style>

		<Style Selector="ToggleButton.SearchToggle:checked ui|FontIcon">
			<Setter Property="RenderTransform" Value="rotate(180deg)" />
		</Style>
	</UserControl.Styles>
	<Grid>
    <DataGrid x:Name="ModInfoDataGrid"
              Grid.Row="1"
              ItemsSource="{Binding ModViewModels}"
              RowHeight="26"
              GridLinesVisibility="{Binding DataGridOptions.GridLinesVisibility, Mode=TwoWay}"
              HeadersVisibility="All"
              CanUserSortColumns="True"
              CanUserResizeColumns="True"
              CanUserReorderColumns="True"
              CornerRadius="4"
              ClipToBounds="True"
              IsEnabled="{Binding !State.IsEngineRunning}"
              Background="{DynamicResource ControlContent}"
              Classes="DragAndDrop ItemsDragAndDrop">
      <DataGrid.Columns>
        <DataGridTemplateColumn Header="{Binding}"
                                CanUserResize="False"
                                CanUserReorder="False"
                                CanUserSort="False"
                                MinWidth="30"
                                MaxWidth="30"
                                Width="*">
          <DataGridTemplateColumn.HeaderTemplate>
            <DataTemplate x:DataType="vm:PatchBoxViewModel">
              <CheckBox x:Name="checkBoxHeader" 
                        IsChecked="{Binding AllSelected, Mode=OneWay}"
                        Padding="0" HorizontalAlignment="Center" VerticalAlignment="Center"
                        Command="{Binding ToggleSelectAllCommand}"
                        CommandParameter="{Binding $self.IsChecked}">
                <CheckBox.RenderTransform>
                  <ScaleTransform ScaleX="0.75" ScaleY="0.75"  />
                </CheckBox.RenderTransform>
              </CheckBox>
            </DataTemplate>
          </DataGridTemplateColumn.HeaderTemplate>
          <DataGridTemplateColumn.CellTemplate>
            <DataTemplate x:DataType="vm:ModInfoViewModel">
              <CheckBox IsChecked="{Binding Active}" 
                        IsEnabled="{Binding Code, Converter={StaticResource PandoraCodeToEnabledConverter}}"
                        Padding="0" HorizontalAlignment="Center" VerticalAlignment="Center">
                <CheckBox.RenderTransform>
                  <ScaleTransform ScaleX="0.75" ScaleY="0.75" />
                </CheckBox.RenderTransform>
              </CheckBox>
            </DataTemplate>
          </DataGridTemplateColumn.CellTemplate>
        </DataGridTemplateColumn>
        <DataGridTextColumn Header="Name"
                            Binding="{Binding Name}"
                            x:DataType="vm:ModInfoViewModel"
                            MinWidth="100"
                            Width="*" 
                            CanUserReorder="False" />
        <DataGridTextColumn Header="Author"
                            Binding="{Binding Author}"
                            x:DataType="vm:ModInfoViewModel"
                            MinWidth="84"
                            Width="*" />
        <DataGridTextColumn Header="Version"
                            Binding="{Binding Version}"
                            x:DataType="vm:ModInfoViewModel"
                            MinWidth="64"
                            Width="*" />
        <DataGridTextColumn Header="Code"
                            Binding="{Binding Code}"
                            x:DataType="vm:ModInfoViewModel"
                            MinWidth="64"
                            Width="*" />
      </DataGrid.Columns>
    </DataGrid>
		<AutoCompleteBox
            MaxWidth="280"
            FontSize="13"
            Watermark="Search"
            VerticalAlignment="Bottom"
						Text="{Binding State.SearchTerm}"
            Margin="0 0 0 6"
            CornerRadius="16"
            Classes="SampleApp SearchBox"
            Classes.Open="{Binding IsSearchVisible}">
		</AutoCompleteBox>

		<ToggleButton Theme="{StaticResource TransparentButton}"
									HorizontalAlignment="Right"
									VerticalAlignment="Bottom"
									Margin="0 0 6 6"
									HotKey="Ctrl+F"
									IsChecked="{Binding IsSearchVisible, Mode=TwoWay}"
									Classes="SearchToggle">
			<ui:FontIcon Glyph="&#xE70E;"
									 FontSize="16"
									 FontFamily="{StaticResource SymbolThemeFontFamily}" />
		</ToggleButton>

	</Grid>

</UserControl>
