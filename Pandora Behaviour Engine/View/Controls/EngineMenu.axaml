<!--
  ~ SPDX-License-Identifier: GPL-3.0-or-later
  ~ Copyright (C) 2023-2026 Pandora Behaviour Engine Contributors
-->

<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:Pandora.ViewModels"
             mc:Ignorable="d" d:DesignWidth="500"
             x:Class="Pandora.Views.EngineMenu"
             xmlns:ui="using:FluentAvalonia.UI.Controls"
             x:DataType="vm:EngineViewModel">
  <Grid Name="TitleBarHost" ColumnDefinitions="Auto,Auto,*,Auto,Auto" Background="Transparent">
    <ui:IconSourceElement Name="WindowIcon"
                          IconSource="{StaticResource IconPandora}"
                          Width="22" Height="22"
                          Margin="0 -2 0 0" />
    <Menu MinWidth="110" FontSize="13" Grid.Column="1" IsEnabled="{Binding !EngineRunning}">
	  <MenuItem Header="About" Command="{Binding ShowAboutDialogCommand}" />
      <MenuItem Header="Menu" Classes="SubItems" ItemsSource="{Binding EngineConfigurationViewModels}">
        <MenuItem.ItemTemplate>
          <TreeDataTemplate ItemsSource="{Binding NestedViewModels}" x:DataType="vm:IEngineConfigurationViewModel">
            <TextBlock Text="{Binding Name}" />
          </TreeDataTemplate>
        </MenuItem.ItemTemplate>
        <MenuItem.Styles>
          <Style Selector="MenuItem.SubItems MenuItem" x:DataType="vm:IEngineConfigurationViewModel">
            <Setter Property="ToggleType" Value="Radio" />
			      <Setter Property="Header" Value="{Binding Name}" />
			      <Setter Property="Command" Value="{Binding SetCommand}" />
            <Setter Property="CommandParameter" Value="{Binding}" />
          </Style>
        </MenuItem.Styles>
      </MenuItem>
	  <MenuItem Header ="Paths">
	    <MenuItem Header="Game" Command="{Binding PickGameDirectoryCommand}" />
		<MenuItem Header="Output" Command="{Binding PickOutputDirectoryCommand}" />
	  </MenuItem>
	</Menu>
    <Border Grid.Column="2" VerticalAlignment="Center">
      <AutoCompleteBox x:Name="searchTextBox"
                       Classes="SampleApp"
                       MaxWidth="280"
                       FontSize="13"
                       Text="{Binding SearchTerm}"
                       Watermark="Search" 
                       IsEnabled="{Binding !EngineRunning}" />
    </Border>
    <ToggleButton Name="ThemeToggle" 
                  Grid.Column="3" 
                  Height="30"
                  IsThreeState="False"
                  IsChecked="{Binding SettingsApp.ThemeToggleState}" 
                  VerticalAlignment="Center"
                  Theme="{StaticResource TransparentButton}">
      <Interaction.Behaviors>
        <EventTriggerBehavior EventName="Click">
          <ToggleViewModelBooleanAction PropertyName="SettingsApp.ThemeToggleState" />
        </EventTriggerBehavior>
        <DataTriggerBehavior Binding="{Binding #ThemeToggle.IsChecked}" Value="True">
          <SetPathIconDataAction PathIcon="ThemeIcon" Data="{StaticResource IconThemeDark}" />
        </DataTriggerBehavior>
        <DataTriggerBehavior Binding="{Binding #ThemeToggle.IsChecked}" Value="False">
          <SetPathIconDataAction PathIcon="ThemeIcon" Data="{StaticResource IconThemeLight}" />
        </DataTriggerBehavior>
      </Interaction.Behaviors>
      <Viewbox>
        <PathIcon Name="ThemeIcon" Data="{StaticResource IconThemeLight}" Foreground="{Binding #ThemeToggle.Foreground}" />
      </Viewbox>
    </ToggleButton>
    <Rectangle Grid.Column="4" Height="24" Width="1" Fill="{DynamicResource MenuFlyoutSeparatorBackground}" HorizontalAlignment="Left" Margin="4 0 0 0" />

    <ui:TaskDialog Name="AboutDialog"
                   Header="{x:Static vm:AboutDialogViewModel.Header}"
                   SubHeader="{x:Static vm:AboutDialogViewModel.SubHeader}"
                   Content="{x:Static vm:AboutDialogViewModel.Content}"
                   FooterVisibility="Never"
                   IsFooterExpanded="False"
                   ShowProgressBar="False"
                   IconSource="{DynamicResource IconPandora}">
      <ui:TaskDialog.Commands>
        <ui:TaskDialogCommand Text="Check Update"
                              Description="Check for a new version"
                              IsEnabled="False"
                              ClosesOnInvoked="False">
          <ui:TaskDialogCommand.IconSource>
            <ui:SymbolIconSource Symbol="Refresh" />
          </ui:TaskDialogCommand.IconSource>
        </ui:TaskDialogCommand>

        <ui:TaskDialogCommand Text="GitHub"
                              Description="Visit GitHub page"
                              IsEnabled="True"
                              ClosesOnInvoked="False"
                              IconSource="{DynamicResource IconGithub}">
          <Interaction.Behaviors>
            <EventTriggerBehavior EventName="Click">
              <LaunchUriOrFileAction Path="https://github.com/Monitor221hz/Pandora-Behaviour-Engine-Plus" />
            </EventTriggerBehavior>
          </Interaction.Behaviors>
        </ui:TaskDialogCommand>

        <ui:TaskDialogCommand Text="Discord"
                              Description="Join the Discord group"
                              IsEnabled="True"
                              ClosesOnInvoked="False"
                              IconSource="{DynamicResource IconDiscord}">
          <Interaction.Behaviors>
            <EventTriggerBehavior EventName="Click">
              <LaunchUriOrFileAction Path="https://discord.gg/8nUQCWMn3w" />
            </EventTriggerBehavior>
          </Interaction.Behaviors>
        </ui:TaskDialogCommand>
      </ui:TaskDialog.Commands>

      <ui:TaskDialog.Buttons>
        <ui:TaskDialogButton Text="Close" DialogResult="Close" />
      </ui:TaskDialog.Buttons>
    </ui:TaskDialog>

  </Grid>
  
</UserControl>
